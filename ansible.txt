24-12-2025
===========

ansible:
========
Four pillars of any scripting:
--------------------------------
1.variable
2.function
3.condition
4.loop

** Yes, Puppet required agent software on each node.
** Ansible came into the picture to solve this by using SSH to load and apply configurations without any agent.

limitations in shell scripting:
===============================
1.You must log in to each server manually
2.No centralized control
3.No built-in idempotency means script executes line by line and the package is installed or not to check with the exit status.
to avoid writing line-by-line checks and constant exit-status conditions, we move to Ansible


Centralized Control
===================
Meaning: The ability to manage and configure multiple servers from a single control server.

if there is any update in script , we have to login on specific server and run manually.
tracking the server is also difficult
ansible is a centralized control to login one server and targets multiple servers and its easy to track the servers and to change the code and run easily.

configuration management software:
==================================
ansible is a Configuration tool.
To run configuration management tasks in Ansible:
1.Write a playbook describing the desired state of servers
2.Specify the inventory (servers)
3.Run ansible-playbook from your control node
4.Ansible automatically applies the configuration to all targeted servers
Two approaches:
===============
Push model[ansible-playbook]: CM(configuration management) software (like Ansible) pushes configuration from control node → targets.
Pull model[using Git + CM tool)]: Servers pull playbooks/code from Git and run configuration locally.[ansible-pull -U https://github.com/user/repo.git -i localhost, site.yml[ansible-pull]
]
push based is the default in ansible[ansible-playbook]
ansible-pull -U https://github.com/user/repo.git -i localhost, site.yml
ansible-pull: always runs on the server where you execute it
-i localhost, means the playbook is applied to that machine itself, not to other remote servers

*** Puppet need agent software to push configuration code into target servers, to avoid this we can use ansible

1.Ansible = Python program
2.pip = tool to install Python programs/packages
3.PyPI = source repository where pip gets Ansible

* first check python version
* install latest version of python
* Control Node: Python 3 is required to run Ansible-Core.
* Managed Nodes: Python 3 is generally needed for Linux/Unix targets (except Windows, which uses WinRM).


ansible --version

two extensions:
----------------
1. INI
2.YAML

inventory.ini:
==============
to keep all hosts in one file
vim list
1.1.1.1
1.2.2.2
1.2.3.3

to run : ansible -i list all --lists-hosts
here -i is an inventory
list is a  name
all means all servers
--list-hosts: to display all list hosts

modules:
========
copy,template,file,....
tasks:
======
A task is a single instruction in a playbook that calls a module.
Example:

- name: Copy configuration file
  copy:
    src: config.conf
    dest: /etc/config.conf

the task uses the copy module.

what is a playbook?
collection of play we call it as playbook.
- hosts: webservers
  tasks:
    - name: Install Nginx
      apt:
        name: nginx
        state: present

- hosts: dbservers
  tasks:
    - name: Install MySQL
      apt:
        name: mysql-server
        state: present
here two plays : webservers , dbservers
what is a play?
A play is a set of tasks that runs on a defined group of hosts.
what is a tasks?
A single instruction in a playbook that calls a module.
collection of modules to run under tasks
A task uses a module to perform an action.
- hosts: webservers
  tasks:
    - name: Install Nginx
      apt:
        name: nginx
        state: present
    - name: Copy config
      copy:
        src: nginx.conf
        dest: /etc/nginx/nginx.conf
multiple tasks i
what is a module?
A unit of work that performs a specific action on a target node.
copy, template,file,...
Modules are the actual code executed by Ansible

Playbook → contains one or more Plays
Play → contains one or more Tasks
Task → calls a Module
Module → performs an action (copy, template, file, etc.)


Ansible Controller → central machine that runs Ansible and initiates connections.
Remote Nodes → target machines that receive commands/tasks.
Connection → SSH or WinRM; no agent required

** Controller Node = Main server that runs Ansible and controls other servers

Adhoc commands:
===============
it is a one line ansible commands used to perform tasks without writing a playbook.
The ping module is used to test connectivity between the Ansible controller and managed nodes.
ansible controller: control node
managed nodes: target nodes

uptime Command:
===============
Displays how long the system has been running.
$ uptime
 12:30:01 up 5 days,  3:12,  2 users,  load average: 0.15, 0.10, 0.05
Information it provides:
-------------------------
Current time
How long the system has been up
Number of users currently logged in
System load averages for the last 1, 5, and 15 minutes




inventory examples:
===================
* ansible -i list all --list-hosts
* ansible -i list frontend --list-hosts
* ansible -i frontend001.xyz.com,10.4.1.10, all --list-hosts

SSO means you authenticate once (e.g., with SSH key, Kerberos ticket, or centralized login) and you can access all target nodes without re-entering passwords.
ansible-playbook -i list all -e ansible-user=ec2-user -e ansible-password=DevOps321

** to check configuration file in a version
ansible --version
* enter ---> ansible
* ansible-config --help
*


ansible-core=engine
ansible = engine+curated collections



1. what is configuration?
Configuration generally refers to setting up a system or environment so that software runs correctly.
This can include tasks such as:

Installing packages (e.g., installing software dependencies)
Copying or placing files in required directories
Cloning or adding repositories
Starting, enabling, or setting up services
Editing configuration files (e.g., .conf, .yaml, .env)
Setting environment variables
Adjusting permissions or system settings


25/12
====
yaml rules:
-----------
1. yaml uses space not tabs
name: abc
age: 20

indentation problem:
--------------------
name: abc
    age: 20 // too many spaces
2. key:value
============
name: abc
age: 30

3.lists(arrays)
----------------
item:
 - loop1
 - loop2

4.Inline List
--------------
items: [loop1,loop2,loop3]

5.Dictionaries(maps):
---------------------
person:
  name: abc
  age: 30

6.Inline Map:
---------------
person: { name: abc, age:30 }

Multiline Strings:
------------------
Block Scalar:
--------------
message: |
   to provide a string in multiple ways
   this is a blocks scalar

Folded Scalar:
--------------
message: >
   to provide a string in multiple ways
   this is a folded scalar

 ex:
 ---
 test.yaml
 ---------
 hosts: all
 tasks:
   - ping:

to run yaml file:
==================
ansible-playbook -i "hosts", test.yaml -e ansible_user=ec2-user -e ansible_password=DevOps321
ex:2
----
test.yaml
hosts: all
tasks:
  - ping:
    name: ping module
  - debug:
    name: Print message
      msg: "Hello universe"

** ansible template and ansible playbook both are different
modules:
=========
- name: Copy and unpack archive
  ansible.builtin.unarchive:
    src: /local/path/app.tar
    dest: /remote/destination/
    remote_src: no


| Option            | Meaning                                                                                                 |
| ----------------- | ------------------------------------------------------------------------------------------------------- |
| `src`             | Path to the archive (local by default)                                                                  |
| `dest`            | Directory on remote host to unpack the archive                                                          |
| `remote_src: no`  | Indicates the archive is local → Ansible copies it first                                                |
| `remote_src: yes` | Indicates the archive **already exists on the remote host** → Ansible skips copying and just unpacks it |


Local machine
   │
   │  copy .tar file
   ▼
Remote host (temp location)
   │
   │  unpack/extract to dest directory
   ▼
Remote host (dest directory)


How Ansible works step by step?

* Ansible is installed on the Control Node
* This is where you run your playbooks and commands.
* Control Node connects to the Target Node
* Uses SSH for Linux/Unix or WinRM for Windows.
* Control Node sends Python modules temporarily
* Ansible copies small Python scripts (modules) to the target node for each task.
* Target Node executes the modules using its Python interpreter
* The Python interpreter on the target node runs the module scripts.
* Tasks like installing packages, copying files, or starting services are performed here.
* Results are sent back to the Control Node
* After execution, the module output is returned to the Control Node.
* Temporary files/modules on the target node are usually removed automatically.
* Playbook continues to the next task
* Steps 3–5 are repeated for each task until the playbook finishes.


**ping module:
=============
ansible-playbook -i <host>, all -e ansible_user=ec2-user -e ansible_password=DevOps321 -m ping:   returns pong response and pyhton interpreter version

variables in ansible:
--------------------
ansible-playbook -i hosts.ini 01-variables.yaml -e ansible_user=ec2-user -e ansible_password=DevOps321
playbook:
========
- name: inventory
  hosts: demo
  tasks:
    - name: inventory
      debug:
         msg: x -- {{ x }} y -- {{ y }}

hosts.ini
=========
[shipping]
frontend.dev.pdevops78.online x=100
172.31.67.75 p=200

[shipping:vars]
y=100


output:
========
1️⃣ Host: frontend.dev.pdevops78.online

x=100 (host variable)
y=100 (group variable)

2️⃣ Host: 172.31.67.75
p=200 (host variable)
y=100 (group variable)

here shipping is a group in an inventory.

Playbook variables:
===================
without inventory:
---------------
hosts: localhost
connection: local
This tells Ansible:

hosts: localhost → target the local machine
connection: local → do not use SSH, execute tasks directly on the same system

with inventory:
---------------
Inventory contains localhost
-----------------------------
If your inventory includes:

[local]
localhost ansible_connection=local

Then your playbook can simply use:
hosts: localhost

***ansible --help only shows CLI options such as:
-i for inventory
-m for modules
-a for arguments
-e for extra-vars

Use this command to see built-in connection variables
ansible-doc -t connection -l
Then choose a connection plugin, for example:
ansible-doc -t connection ssh
This shows all variables related to SSH such as:
ansible_connection
ansible_host
ansible_user
ansible_port
ansible_ssh_common_args
Use this command to see built-in connection variables
ansible-doc -t connection -l

Then choose a connection plugin, for example:
ansible-doc -t connection ssh

This shows all variables related to SSH such as:
ansible_connection
ansible_host
ansible_user
ansible_port
ansible_ssh_common_args


playbook variables:
====================
- name: print variables
  hosts: localhost
  connection: local
  vars:
     x: 100 //playbook level
  tasks:
    - name: print variables
      debug:
        msg: x - {{ x }}


 when we provide hosts as localhost then no need to provide ip address/dns record
 ansible-playbook 02-variables.yaml


 ** to declare files through playbook level
- name: declare files playbook level
  hosts: localhost
  connection: local
  var_files:
    - values.yaml
  tasks:
    - name: print url variable
      debug:
        msg: url - {{ url }}


 values.yaml:
 ============
 url: google.com

 role level
 ============
 role ---> demo ---> tasks ---> main.yaml
                     vars ----> main.yaml

 main.yaml:
 ==========
 - name: print variables
   debug:
     msg: url --- {{ url }}

main.yaml:
==========
url: role.google.com

03.variables.yaml:
==================
- name: print variables
  hosts: localhost
  connection: local
  roles:
    - demo

✔️ Playbook

A YAML file that contains one or more plays.

Example: site.yaml, deploy.yaml, etc.

A playbook is the whole file.

✔️ Play

A section inside the playbook.

Each play starts with - hosts: ...

A play maps hosts → tasks.


- name: First play
  hosts: web
  tasks:
    - debug:
        msg: "Running on web servers"

- name: Second play
  hosts: db
  tasks:
    - debug:
        msg: "Running on db servers"

The file site.yaml → Playbook

First - hosts: web section → Play 1

Second - hosts: db section → Play 2

So the playbook has two plays.

| Term         | Meaning                                                |
| ------------ | ------------------------------------------------------ |
| **Playbook** | YAML file containing plays                             |
| **Play**     | A block inside the playbook that defines hosts + tasks |

One playbook can have one or many plays.
A play can have tasks, vars, roles, etc.


default role:
==============
default----> main.yaml
main.yaml
----------
port: 8080
to provide default values to the role level variables
hosts: localhost
role:
  - demo

demo
----
main.yaml
==========
- name:
  debug:
    msg: {{ port }}

in role level we should not provide port then default port will use.